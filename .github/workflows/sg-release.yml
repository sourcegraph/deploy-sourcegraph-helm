name: sg-release

on: 
  workflow_dispatch

env:


jobs:
  sg-release:
    name: Run a release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Install sg
        run: curl -L --proto '=https' --tlsv1.2 -sSLf -o sg https://github.com/sourcegraph/sg/releases/download/2024-06-11-15-14-add4baa4/sg_linux_amd64_static

          chmod +x sg
      - name: Update apt
        run: apt update && apt upgrade -y
      - name: Install dependencies
        run: apt-get install libpcre3-dev libev4  -y
      - name: Install Comby
        run: bash <(curl -sL get-comby.netlify.app)
      - name: Install gh
        run: apt install gh
      - name: Run sg    
        run: ./sg release create --version=auto --inputs=server=auto --pretend
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
