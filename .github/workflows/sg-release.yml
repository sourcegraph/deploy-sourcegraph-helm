name: sg-release

on: 
  [workflow_dispatch, repository_dispatch]

jobs:
  sg-internal-release:
    if: ${{ github.event.event_type == "internal" }}
    name: Run an Internal Release
    runs-on: ubuntu-latest
    uses: ./.github/workflows/release-setup.yml
    steps:
      - name: Run sg
        run: ./sg release create --version=$VERSION --inputs=server=$VERSION --pretend
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
          VERSION: ${{ github.event.client_payload.version }}

  sg-promote-release:
    if: ${{ github.event.event_type == "promote" }}
    name: Run a Promotion Release
    runs-on: ubuntu-latest
    uses: ./.github/workflows/release-setup.yml
    steps:
      - name: Run sg    
        run: ./sg release promote-to-public --version=$VERSION --inputs=server=$VERSION --pretend
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
          VERSION: ${{ github.event.client_payload.version }}
