# These values are dervied from https://github.com/sourcegraph/deploy-sourcegraph-helm/blob/main/charts/sourcegraph/values.yaml

### Common Configuration ###
sourcegraph:
  image:
    # -- Global docker image tag
    defaultTag: '{{ .Chart.AppVersion }}'
    # -- Global docker image pull policy
    pullPolicy: IfNotPresent
    # -- Global docker image registry or prefix
    repository: index.docker.io/sourcegraph
    # -- When set to true, sourcegraph.image.defaultTag is used as the default defaultTag for all services, instead of service-specific default defaultTags
    useGlobalTagAsDefault: false
  # -- Mount named secrets containing docker credentials
  imagePullSecrets: [ ]
  # -- Add a global label to all resources
  labels: { }
  # -- Set a custom name for the app.kubernetes.io/name annotation
  nameOverride: ""
  # -- Affinity,
  # learn more from the [Kubernetes documentation](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity)
  affinity: { }
  # -- NodeSelector,
  # learn more from the [Kubernetes documentation](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector)
  nodeSelector: { }
  # -- Tolerations,
  # learn more from the [Kubernetes documentation](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/)
  tolerations: [ ]
  # -- Add extra annotations to attach to all pods
  podAnnotations: { }
  # -- Add extra labels to attach to all pods
  podLabels: { }


storageClass:
  # -- Enable creation of storageClass. Defaults to Google Cloud Platform. Disable if you have your own existing storage class
  create: false
  # -- Name of the storageClass.
  # Use to customize to the existing storage class name
  name: sourcegraph
  # -- Name of the storageClass provisioner,
  # learn more from the [Kubernetes documentation](https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner)
  # and consult your cloud provider persistent storage documentation
  provisioner: kubernetes.io/gce-pd
  # -- Value of `type` key in storageClass `parameters`,
  # consult your cloud provider persistent storage documentation
  type: pd-ssd
  # -- Extra parameters of storageClass,
  # consult your cloud provider persistent storage documentation
  parameters: { }
  # -- Persistent volumes topology configuration,
  # learn more from the [Kubernetes documentation](https://kubernetes.io/docs/concepts/storage/storage-classes/#allowed-topologies)
  allowedTopologies: { }


# Generic application configuration options, used by most applications below
# app: # Generally matches directory name
#   replicaCount: 1
#
#   image:
#     # Application-specific default tag. Overrides the global tag. Do not modify - use tag instead
#     defaultTag:
#     # Override the default tag on a service-specific basis
#     tag:
#     # Override the default docker image name
#     name:
#
#   # Add additional labels and annotations to various resources
#   labels: {}
#   podLabels: {}
#   podAnnotations: {}
#   serviceLabels: {}
#   serviceAnnotations: {}
#   # Override default service/deployment names
#   name: ""
#   # Provide custom environment variables
#   env: {}
#   # Set resource requests / limits
#   resources: {}
#   podSecurityContext: {}
#   securityContext: {}
#   # Add additional volumes and mounts to deployments
#   extraVolumeMounts: {}
#   extraVolumes: {}
#   # Add sidecars
#   extraContainers: {}
#   # Toggle serviceAccount creation
#   serviceAccount.create: true
#   # Customize service account name
#   serviceAccount.name: ""
#   # Override service type (defaults to ClusterIP)
#   serviceType: ""
#   # Set disk size on PVC's for stateful deployments
#   storageSize: ""
#   # Optionally bind PVC's to an existing PV
#   volumeName: ""
#   # Use an existing configmap (specified by name) instead of creating one
#   existingConfig: ""
#   # Toggle deployment of applications on/off. Applies to databases and third-party applications
#   enabled: true

# -- Whether to deploy the private registry. Only one registry is needed when deploying multiple executors.
# More information: https://docs.sourcegraph.com/admin/executors/deploy_executors#using-private-registries
privateDockerRegistry:
  enabled: true
  image:
    registry: index.docker.io
    repository: registry
    tag: 2
  storageSize: 1Gi

# -- Whether to configure the necessary RBAC resources. Required only once for all executor deployments.
rbac:
  enabled: true


executor:
  replicas: 1
  enabled: true
  image:
    defaultTag: executor-kubernetes:5.1_230340_2023-06-23_5.0-93d39d620e83@sha256:172770133661d4d148327d2cac87c051a6409871ee6f6e28ce3495b60f883ad5
    name: "executor-kubernetes"
  # -- The external URL of the Sourcegraph instance. Required.
  frontendUrl: ""
  # -- The shared secret configured in the Sourcegraph instance site config under executors.accessToken. Required.
  frontendPassword: ""
  # -- The name of the queue to pull jobs from to. Possible values: batches and codeintel. Either this or queueNames is required.
  queueName: ""
  # -- The names of multiple queues to pull jobs from to. Possible values: batches and codeintel. Either this or queueName is required.
  queueNames: [ ]
  maximumNumJobs: 10
  maximumRuntimePerJob: "30m"
  
  log:
    level: "info"
    format: "condensed"
    trace: "false"
  
  storageSize: 10Gi
  namespace: "default"
  kubeconfigPath: ""
  
  kubernetesJob:
    deadline: "1200"
    runAsUser: ""
    runAsGroup: ""
    fsGroup: "1000"
    resources:
      requests:
        cpu: ""
        memory: "1Gi"
      limits:
        cpu: ""
        memory: "12Gi"
    
    node:
      name: ""
      selector: ""
      tolerations: ""
      requiredAffinityMatchExpressions: ""
      requiredAffinityMatchFields: ""

    pod:
      affinity: ""
      antiAffinity: ""
  
  debug:
    keepJobs: "false"
    keepWorkspaces: "false"
  
  # -- Affinity,
  # learn more from the [Kubernetes documentation](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity)
  affinity: { }
  
  # -- NodeSelector,
  # learn more from the [Kubernetes documentation](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector)
  nodeSelector: { }
  
  # -- Tolerations,
  # learn more from the [Kubernetes documentation](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/)
  tolerations: [ ]
  
  extraEnv:
#   - name: MY_ENV
#     value: my_value
  
  # -- For local deployments the host is 'host.docker.internal' and this needs to be true
  dockerAddHostGateway: "false"
